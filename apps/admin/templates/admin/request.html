{% extends 'places/base.html' %}
{% load humanize %}
{% load static %}
{% block head %}
{{ block.super }}
<style>
    .table-places {
        display: inline-table;
        border-collapse: separate;
        border-spacing: 4px;
        text-align: center;
    }

    .table-places td {
        text-align: center;
        padding: .3rem .7rem !important;
        color: white !important;
        margin: 2px !important;
    }

    .table-places tr {
        border: 0 transparent !important;
    }

    td[data-status="available"] {
        cursor: pointer;
    }

    td.selected {
        outline: 3px solid #332D2D;
    }

    td[data-status="unavailable"] {
        background-color: #9FA6B2 !important;
    }
</style>
<script src="{% static 'js/validations.js' %}" defer></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.17.2/dist/sweetalert2.all.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.17.2/dist/sweetalert2.min.css">
<script src="{% static 'js/request.js' %}" type="module" defer></script>
<script src="{% static 'js/easytimer.min.js' %}" defer></script>
{% endblock head %}
{% load static %}
{% block main %}
<div class="container-fluid p-5">
    <form method="post">
        {% csrf_token %}
        <div class="row gx-xl-5">
            <div class="col-xl-3">
                <div class="shadow-4 bg-white rounded-5 overflow-hidden mb-4">
                    <div class="bg-light p-4 text-center">
                        <h5 class="mb-0">Asigna un Estatus</h5>
                    </div>
                    <div class="p-4">
                        {% if not object.estatus or object.estatus == 'resolved' %}
                        {% if object.estatus == 'resolved' %}
                        <h1 class="text-center"><span class="badge rounded-pill badge-primary mb-2">Solventado</span>
                        </h1>
                        {% endif %}
                        <button name="validated" type="submit" data-mdb-ripple-init data-mdb-ripple-color="dark"
                            class="btn btn-lg btn-rounded btn-outline-success shadow-0 w-100">
                            <i class="fas fa-check me-2"></i>
                            Validar
                        </button>
                        <button name="validated-payment" type="submit" data-mdb-ripple-init data-mdb-ripple-color="dark"
                            class="btn btn-lg btn-rounded btn-outline-success shadow-0 w-100 mt-3">
                            <i class="fas fa-people-arrows me-2"></i>
                            Validar Directo
                        </button>
                        <button name="pending" type="submit"
                            class="btn btn-outline-warning btn-lg btn-rounded shadow-0 w-100 my-3"><i
                                class="fas fa-triangle-exclamation me-2"></i>Observar
                        </button>
                        <a data-mdb-toggle="collapse" data-mdb-target="#reject-comments"
                            class="btn btn-outline-danger btn-lg btn-rounded shadow-0 w-100" href="#"><i
                                class="fas fa-ban me-2"></i>Rechazar
                        </a>
                        <div class="collapse text-right" id="reject-comments">
                            <div class="form-outline mt-3">
                                <textarea name="reject-comments" class="form-control mb-1" rows="4" placeholder="Escriba la razón por la cuál rechaza esta Solicitud"></textarea>
                            </div>
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <button name="rejected" type="submit" class="btn btn-danger shadow-0 btn-sm">Confirmar</button>
                            </div>
                        </div>
                        {% elif object.estatus == 'validated' %}
                        <h1 class="text-center"><span class="badge rounded-pill badge-success">Validado</span>
                        </h1>
                        {% elif object.estatus == 'validated-direct' %}
                        <h1 class="text-center"><span class="badge rounded-pill badge-success">Validación directa</span>
                        </h1>
                        {% elif object.estatus == 'rejected' %}
                        <h1 class="text-center"><span class="badge rounded-pill badge-danger">Rechazado</span>
                        </h1>
                        {% elif object.estatus == 'pending' %}
                        <h1 class="text-center"><span class="badge rounded-pill badge-warning">Observado</span>
                        </h1>
                        {% endif %}
                    </div>
                    <div class="bg-light p-4 text-center">
                        <h5 class="mb-0">Historial de Validaciones</h5>
                    </div>
                    <div class="p-4">
                        <button type="button" class="btn btn-primary btn-lg btn-rounded shadow-0 w-100"
                            data-mdb-toggle="modal" data-mdb-target="#modal-validations">
                            <i class="fas fa-list-check me-2"></i>Ver Historial
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-xl-9 mb-4 mb-lg-0">
                {% if object.estatus == 'validated' %}
                {% if not selected_places %}
                <div class="alert" role="alert" data-mdb-color="warning">
                    <i class="fas fa-exclamation-triangle me-3"></i>Para continuar con el proceso de la
                    Solicitud <a href="#places" class="btn btn-sm btn-warning shadow-0 ms-2">Asigna un
                        espacio</a>
                </div>
                {% endif %}
                {% endif %}
                {% include 'base/validations.html' %}
                <div
                    class="shadow-4 bg-white rounded-5 mb-4 overflow-hidden p-4 d-flex justify-content-between align-items-center">
                    <h4 class="mb-0 fw-bold">
                        <i class="fas fa-clipboard-list me-3 green-text"></i>Solicitud {{ object.folio }}
                        - {{ object.id }}
                    </h4>
                    <a class="btn btn-lg btn-link btn-rounded d-none d-sm-block" href="{% url 'admin:list_requests' %}"
                        role="button">Ver
                        todo<i class="fas fa-arrow-right ms-2"></i></a>
                </div>
                <div class="shadow-4 bg-white rounded-5 p-4">
                    <div class="d-flex justify-content-end">
                        {% if object.usuario.citas.first %}
                        <a href="{% url 'admin:download_date' object.uuid object.usuario.citas.first.uuid %}"
                            type="button" class="btn btn-sm shadow-0 btn-success btn-rounded mb-2 me-2"><i
                                class="fas fa-download me-2"></i>Descargar Citas</a>
                        {% endif %}
                        {% if object.comercio %}
                        <a href="{% url 'admin:shop' object.comercio.uuid %}" type="button"
                            class="btn btn-sm shadow-0 btn-info btn-rounded mb-2"><i class="fas fa-shop me-2"></i>Ver
                            comercio</a>
                        {% endif %}
                        <a href="{% url 'admin:update_request' object.uuid %}" type="button"
                            class="btn btn-sm shadow-0 btn-primary btn-rounded mb-2 ms-2"><i
                                class="fas fa-pen me-2"></i>Editar</a>
                    </div>
                    <ul class="list-group list-group-light">
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold">{{ object.fecha_reg }} hrs.</div>
                                <small>Fecha de registro</small>
                            </div>
                        </li>
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold">{{ object.folio }}</div>
                                <small>Folio</small>
                            </div>
                        </li>
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                {% if object.comercio %}
                                <div class="fw-bold"><a href="{% url 'admin:shop' object.comercio.uuid %}">
                                        {{ object.comercio.folio }}</a>
                                </div>
                                {% else %}
                                <div class="fw-bold">No especificado</div>
                                {% endif %}
                                <small>Comercio relacionado</small>
                            </div>
                        </li>
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold">{{ object.cantidad_espacios }}</div>
                                <small>Espacios Seleccionados</small>
                            </div>
                        </li>
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold">
                                    <input class="form-check-input me-1" type="checkbox" value="mas_espacios" />
                                    {{ object.get_mas_espacios_display }}
                                </div>
                                <small>Requiero más de 3 espacios</small>
                            </div>
                            <div>
                                <div class="form-outline" data-mdb-input-init>
                                    <textarea class="form-control d-none" rows="3"></textarea>
                                    <label class="form-label">Observaciones</label>
                                </div>
                            </div>
                        </li>
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold"><a target="_blank"
                                        href="{% url 'admin:update_user' object.usuario.id %}">
                                        {{ object.usuario.get_full_name }}</a>
                                </div>
                                <small>Usuario relacionado</small>
                            </div>
                        </li>
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold">{{ object.usuario.phone_number }}</div>
                                <small>Número de Teléfono</small>
                            </div>
                        </li>
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold">
                                    <input class="form-check-input me-1" type="checkbox" value="factura" />
                                    {{ object.get_factura_display }}
                                </div>
                                <small>¿Requiere Factura?</small>
                            </div>
                            <div>
                                <div class="form-outline" data-mdb-input-init>
                                    <textarea class="form-control d-none" rows="3"></textarea>
                                    <label class="form-label">Observaciones</label>
                                </div>
                            </div>
                        </li>
                        {% if object.regimen_fiscal %}
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold">
                                    <input class="form-check-input me-1" type="checkbox" value="regimen_fiscal" />
                                    {{ object.get_regimen_fiscal_display }}
                                </div>
                                <small>Régimen Fiscal</small>
                            </div>
                            <div>
                                <div class="form-outline" data-mdb-input-init>
                                    <textarea class="form-control d-none" rows="3"></textarea>
                                    <label class="form-label">Observaciones</label>
                                </div>
                            </div>
                        </li>
                        {% endif %}
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold">
                                    <input class="form-check-input me-1" type="checkbox" value="nombre" />
                                    {{ object.nombre }}
                                </div>
                                <small>Nombre o Razón Social</small>
                            </div>
                            <div>
                                <div class="form-outline" data-mdb-input-init>
                                    <textarea class="form-control d-none" rows="3"></textarea>
                                    <label class="form-label">Observaciones</label>
                                </div>
                            </div>
                        </li>
                        {% if object.nombre_replegal %}
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold">
                                    <input class="form-check-input me-1" type="checkbox" value="nombre_replegal" />
                                    {{ object.nombre_replegal }}
                                </div>
                                <small>Nombre del Representante Legal</small>
                            </div>
                            <div>
                                <div class="form-outline" data-mdb-input-init>
                                    <textarea class="form-control d-none" rows="3"></textarea>
                                    <label class="form-label">Observaciones</label>
                                </div>
                            </div>
                        </li>
                        {% endif %}
                        {% if object.rfc_txt %}
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold">
                                    <input class="form-check-input me-1" type="checkbox" value="rfc_txt" />
                                    {{ object.rfc_txt }}
                                </div>
                                <small>RFC</small>
                            </div>
                            <div>
                                <div class="form-outline" data-mdb-input-init>
                                    <textarea class="form-control d-none" rows="3"></textarea>
                                    <label class="form-label">Observaciones</label>
                                </div>
                            </div>
                        </li>
                        {% endif %}
                        {% if object.curp_txt %}
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold">
                                    <input class="form-check-input me-1" type="checkbox" value="curp_txt" />
                                    {{ object.curp_txt }}
                                </div>
                                <small>CURP</small>
                            </div>
                            <div>
                                <div class="form-outline" data-mdb-input-init>
                                    <textarea class="form-control d-none" rows="3"></textarea>
                                    <label class="form-label">Observaciones</label>
                                </div>
                            </div>
                        </li>
                        {% endif %}
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold">
                                    <input class="form-check-input me-1" type="checkbox" value="calle" />
                                    {{ object.calle }}
                                </div>
                                <small>Calle</small>
                            </div>
                            <div>
                                <div class="form-outline" data-mdb-input-init>
                                    <textarea class="form-control d-none" rows="3"></textarea>
                                    <label class="form-label">Observaciones</label>
                                </div>
                            </div>
                        </li>
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold">
                                    <input class="form-check-input me-1" type="checkbox" value="no_calle" />
                                    {{ object.no_calle }}
                                </div>
                                <small>Número de Casa</small>
                            </div>
                            <div>
                                <div class="form-outline" data-mdb-input-init>
                                    <textarea class="form-control d-none" rows="3"></textarea>
                                    <label class="form-label">Observaciones</label>
                                </div>
                            </div>
                        </li>
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold">
                                    <input class="form-check-input me-1" type="checkbox" value="colonia" />
                                    {{ object.colonia }}
                                </div>
                                <small>Colonia</small>
                            </div>
                            <div>
                                <div class="form-outline" data-mdb-input-init>
                                    <textarea class="form-control d-none" rows="3"></textarea>
                                    <label class="form-label">Observaciones</label>
                                </div>
                            </div>
                        </li>
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold">
                                    <input class="form-check-input me-1" type="checkbox" value="codigo_postal" />
                                    {{ object.codigo_postal }}
                                </div>
                                <small>Código Postal</small>
                            </div>
                            <div>
                                <div class="form-outline" data-mdb-input-init>
                                    <textarea class="form-control d-none" rows="3"></textarea>
                                    <label class="form-label">Observaciones</label>
                                </div>
                            </div>
                        </li>
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold">
                                    <input class="form-check-input me-1" type="checkbox" value="estado" />
                                    {{ object.get_estado_display }}
                                </div>
                                <small>Estado</small>
                            </div>
                            <div>
                                <div class="form-outline" data-mdb-input-init>
                                    <textarea class="form-control d-none" rows="3"></textarea>
                                    <label class="form-label">Observaciones</label>
                                </div>
                            </div>
                        </li>
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold">
                                    <input class="form-check-input me-1" type="checkbox" value="municipio" />
                                    {{ object.municipio }}
                                </div>
                                <small>Municipio</small>
                            </div>
                            <div>
                                <div class="form-outline" data-mdb-input-init>
                                    <textarea class="form-control d-none" rows="3"></textarea>
                                    <label class="form-label">Observaciones</label>
                                </div>
                            </div>
                        </li>
                        {% if object.constancia_fiscal %}
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold mb-2">
                                    <input class="form-check-input me-1" type="checkbox" value="constancia_fiscal" />
                                    Constancia de Situación Fiscal
                                </div>
                                <a href="{{ object.constancia_fiscal.url }}" target="_blank" type="button"
                                    class="btn btn-sm btn-light"><i class="fas fa-eye me-2"></i>Ver documento</a>
                            </div>
                            <div>
                                <div class="form-outline" data-mdb-input-init>
                                    <textarea class="form-control d-none" rows="3"></textarea>
                                    <label class="form-label">Observaciones</label>
                                </div>
                            </div>
                        </li>
                        {% endif %}
                        {% if object.comprobante_domicilio %}
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold mb-2">
                                    <input class="form-check-input me-1" type="checkbox"
                                        value="comprobante_domicilio" />
                                    Comprobante de Domicilio
                                </div>
                                <a href="{{ object.comprobante_domicilio.url }}" target="_blank" type="button"
                                    class="btn btn-sm btn-light"><i class="fas fa-eye me-2"></i>Ver documento</a>
                            </div>
                            <div>
                                <div class="form-outline" data-mdb-input-init>
                                    <textarea class="form-control d-none" rows="3"></textarea>
                                    <label class="form-label">Observaciones</label>
                                </div>
                            </div>
                        </li>
                        {% endif %}
                        {% if object.acta_constitutiva %}
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold mb-2">
                                    <input class="form-check-input me-1" type="checkbox" value="acta_constitutiva" />
                                    Acta Constitutiva
                                </div>
                                <a href="{{ object.acta_constitutiva.url }}" target="_blank" type="button"
                                    class="btn btn-sm btn-light"><i class="fas fa-eye me-2"></i>Ver documento</a>
                            </div>
                            <div>
                                <div class="form-outline" data-mdb-input-init>
                                    <textarea class="form-control d-none" rows="3"></textarea>
                                    <label class="form-label">Observaciones</label>
                                </div>
                            </div>
                        </li>
                        {% endif %}
                        {% if object.poder_notarial %}
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold mb-2">
                                    <input class="form-check-input me-1" type="checkbox" value="poder_notarial" />
                                    Poder Notarial
                                </div>
                                <a href="{{ object.poder_notarial.url }}" target="_blank" type="button"
                                    class="btn btn-sm btn-light"><i class="fas fa-eye me-2"></i>Ver documento</a>
                            </div>
                            <div>
                                <div class="form-outline" data-mdb-input-init>
                                    <textarea class="form-control d-none" rows="3"></textarea>
                                    <label class="form-label">Observaciones</label>
                                </div>
                            </div>
                        </li>
                        {% endif %}
                        {% if object.identificacion %}
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold mb-2">
                                    <input class="form-check-input me-1" type="checkbox" value="identificacion" />
                                    Identificación Oficial
                                </div>
                                <a href="{{ object.identificacion.url }}" target="_blank" type="button"
                                    class="btn btn-sm btn-light"><i class="fas fa-eye me-2"></i>Ver documento</a>
                            </div>
                            <div>
                                <div class="form-outline" data-mdb-input-init>
                                    <textarea class="form-control d-none" rows="3"></textarea>
                                    <label class="form-label">Observaciones</label>
                                </div>
                            </div>
                        </li>
                        {% endif %}
                        {% if object.curp %}
                        <li
                            class="list-group-item list-group-item-action d-flex justify-content-between align-items-start p-3">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold mb-2">
                                    <input class="form-check-input me-1" type="checkbox" value="curp" />
                                    CURP
                                </div>
                                <a href="{{ object.curp.url }}" target="_blank" type="button"
                                    class="btn btn-sm btn-light"><i class="fas fa-eye me-2"></i>Ver documento</a>
                            </div>
                            <div>
                                <div class="form-outline" data-mdb-input-init>
                                    <textarea class="form-control d-none" rows="3"></textarea>
                                    <label class="form-label">Observaciones</label>
                                </div>
                            </div>
                        </li>
                        {% endif %}
                    </ul>
                </div>
                {% if object.estatus == 'validated-direct' %}
                    {% if not payment %}
                    <div data-mdb-alert-init="" class="alert fade alert-success alert-fixed" id="alert-success" role="alert"
                        data-mdb-color="success" data-mdb-position="top-center" data-mdb-stacking="true"
                        data-mdb-append-to-body="true" data-mdb-hidden="true" data-mdb-autohide="true" data-mdb-delay="1000"
                        data-mdb-alert-initialized="true">
                        <i class="fas fa-check-circle me-2"></i> <b>Espacios Actualizados</b>
                    </div>
                    <div data-mdb-alert-init="" class="alert fade alert-warning alert-fixed" id="alert-warning" role="alert"
                        data-mdb-color="warning" data-mdb-position="top-center" data-mdb-stacking="true"
                        data-mdb-append-to-body="true" data-mdb-hidden="true" data-mdb-autohide="true" data-mdb-delay="2000"
                        data-mdb-alert-initialized="true">
                        <i class="fas fa-ban me-2"></i> <b>Selección Cancelada</b>
                    </div>
                    <div data-mdb-alert-init="" class="alert fade alert-warning alert-fixed" id="alert-notplaces"
                        role="alert" data-mdb-color="warning" data-mdb-position="top-center" data-mdb-stacking="true"
                        data-mdb-append-to-body="true" data-mdb-hidden="true" data-mdb-autohide="true" data-mdb-delay="2000"
                        data-mdb-alert-initialized="true">
                        <i class="fas fa-ban me-2"></i> <b>No se preseleccionaron los espacios. Intente con
                            otros
                            espacios.</b>
                    </div>
                    <div class="shadow-4 bg-white rounded-5 my-4 overflow-hidden p-4 d-flex justify-content-between align-items-center"
                        id="places">
                        <h4 class="mb-0 fw-bold">
                            <i class="fas fa-map-pin me-3 green-text"></i>Selección de Espacios
                        </h4>
                        <button type="button" id="reload-places" class="btn btn-lg btn-link btn-rounded"></button>
                    </div>
                    <p class="note note-info mb-4">
                        Al <b>Preseleccionar</b> los espacios se bloquearán por <b>30 minutos</b> y no serán
                        visibles
                        para otros módulos.
                        Si no se confirma la selección, los espacios volverán a estar disponibles después de ese
                        tiempo.
                    </p>
                    <div
                        class="shadow-4 bg-white rounded-5 my-4 overflow-x-scroll p-4 d-flex justify-content-between align-items-center">
                        <button id="n-1" type="button" class="btn btn-light">Nave 1<i
                                class="fas fa-arrows-rotate ms-2"></i></button>
                        <button id="n-2" type="button" class="btn btn-light">Nave 2<i
                                class="fas fa-arrows-rotate ms-2"></i></button>
                        <button id="n-3" type="button" class="btn btn-light">Nave 3<i
                                class="fas fa-arrows-rotate ms-2"></i></button>
                        <button id="z-a" type="button" class="btn btn-light">Zona A<i
                                class="fas fa-arrows-rotate ms-2"></i></button>
                        <button id="z-b" type="button" class="btn btn-light">Zona B<i
                                class="fas fa-arrows-rotate ms-2"></i></button>
                        <button id="z-c" type="button" class="btn btn-light">Zona C<i
                                class="fas fa-arrows-rotate ms-2"></i></button>
                        <button id="z-d" type="button" class="btn btn-light">Zona D<i
                                class="fas fa-arrows-rotate ms-2"></i></button>
                        <button id="s-t" type="button" class="btn btn-light">Sabor a Tabasco<i
                                class="fas fa-arrows-rotate ms-2"></i></button>
                        <button id="teatro" type="button" class="btn btn-light">Teatro al aire libre<i
                                class="fas fa-arrows-rotate ms-2"></i></button>
                    </div>
                    <div class="shadow-4 bg-white rounded-5 p-4 mb-4">
                        <input type="hidden" name="limit_places" value="{{ object.cantidad_espacios }}">
                        <h3 class="text-center mb-3"><span id="zone_title" class="badge badge-info">Selecciona una de las
                                zonas de arriba</span></h3>
                        <div class="table-responsive">
                            <table class="table table-places m-0"></table>
                        </div>
                        <button type="button" id="preselection" disabled
                            class="btn btn-lg btn-rounded btn-primary shadow-0 w-100 mt-3"><i
                                class="fas fa-check me-2"></i>Preseleccionar espacios
                        </button>
                    </div>
                    {% endif %}
                    {% if selected_places %}
                    <div class="shadow-4 bg-white rounded-5 my-4 overflow-hidden p-4 d-flex justify-content-between align-items-center"
                        id="places">
                        <h4 class="mb-0 fw-bold">
                            <i class="fas fa-list-check me-3 green-text"></i>Configuración adicional de los
                            espacios
                            seleccionados ({{ selected_places.count }})
                        </h4>
                    </div>
                    <div class="shadow-4 bg-white rounded-5 p-4 mb-4">
                        {% if not payment %}
                        <div class="d-flex justify-content-end">
                            <button id="add-terraza" type="button"
                                class="btn btn-sm shadow-0 btn-primary btn-rounded mb-3 me-2"><i
                                    class="fas fa-plus me-2"></i>Aplicar 10 % de descuento
                            </button>
                            <button id="add-big-terraza" disabled type="button" style="display: none"
                                class="btn btn-sm shadow-0 btn-primary btn-rounded mb-3 me-2"><i
                                    class="fas fa-plus me-2"></i>Agregar terraza grande
                            </button>
                            <button id="add-alcohol" disabled type="button" style="display: none"
                                class="btn btn-sm shadow-0 btn-primary btn-rounded mb-3"><i
                                    class="fas fa-plus me-2"></i>Agregar licencia de alcohol
                            </button>
                        </div>
                        {% endif %}
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th scope="col">Folio</th>
                                        <th scope="col">Número del lugar</th>
                                        <th scope="col">Sección</th>
                                        <th scope="col">M2</th>
                                        <th scope="col">Precio</th>
                                        <th scope="col">Fecha de asignación</th>
                                        {% if not payment %}
                                        <th></th>
                                        <th></th>
                                        {% endif %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for sp in selected_places  %}
                                    <tr>
                                        <td>
                                        {% if not sp.tpay_descuento %}
                                            <input class="form-check-input config-chk" type="checkbox" value="{{ sp.uuid }}"
                                                data-m2="{{ sp.m2 }}" data-folio="{{ sp.folio }}" />
                                        {% endif %} 
                                        </td>
                                        <th scope="row">{{ sp.folio }}</th>
                                        <td>{{ sp.nombre }}</td>
                                        <td>{{ sp.get_zona_display }}</td>
                                        <td>{{ sp.m2 }}</td>
                                        <td>${{ sp.precio|intcomma }}</td>
                                        <td>{{ sp.fecha_reg }}</td>
                                        {% if not payment %}
                                        <td>
                                            <a href="{% url 'admin:download_receipt' object.uuid sp.uuid %}" type="button" class="btn btn-light btn-sm" data-mdb-ripple-init><i class="fas fa-download me-2"></i>Pase de caja</a>
                                        </td>
                                        <td>
                                            <a class="ms-3 del-place" data-uuid="{{ sp.uuid }}" data-type="place"
                                                role="button">
                                                <i class="fas fa-xmark fa-lg text-danger"></i>
                                            </a>
                                        </td>
                                        {% endif %}
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            <ul class="list-group list-group-light" id="extra-products">
                                <li class="list-group-item d-flex justify-content-end">
                                    <h5 class="me-5 fw-bold m-0">Total por espacios:</h5>
                                    <h5 class="ms-5 m-0">${{ total_places|intcomma }}</h5>
                                </li>
                                {% for p in selected_places %}
                                {% for px in p.extras.all %}
                                <li class="list-group-item d-flex justify-content-end">
                                    {% if px.tipo == 'terraza' %}
                                    <h5 class="m-0 me-5 fw-bold">Total por (1) Terraza para el
                                        espacio ({{ px.to_places }}):
                                    </h5>
                                    <h5 class="m-0 ms-5">${{ px.precio|intcomma }}</h5>
                                    {% elif px.tipo == 'terraza_grande' %}
                                    <h5 class="m-0 me-5 fw-bold">Total por (1) Terraza Grande para
                                        el espacio
                                        ({{ px.to_places }}):
                                    </h5>
                                    <h5 class="m-0 ms-5">${{ px.precio|intcomma }}</h5>
                                    {% elif px.tipo == 'licencia_alcohol' %}
                                    <h5 class="m-0 me-5 fw-bold">Total por (1) Licencia de Alcohol
                                        para el/los espacio(s)
                                        ({{ px.to_places }}):
                                    </h5>
                                    <h5 class="m-0 ms-5">${{ px.precio|intcomma }}</h5>
                                    {% endif %}
                                    {% if not payment %}
                                    <a class="ms-3 del-pdt" data-uuid="{{ px.uuid }}" data-type="{{ px.tipo }}"
                                        role="button"><i class="fas fa-xmark fa-lg text-danger"></i></a>
                                    {% endif %}
                                </li>
                                {% endfor %}
                                {% endfor %}
                                <li class="list-group-item d-flex justify-content-end">
                                    <h5 class="me-5 fw-bold m-0">Total por conceptos adicionales:</h5>
                                    <h5 class="ms-5 m-0">${{ total_extras|intcomma }}</h5>
                                </li>
                            </ul>
                            <div class="d-flex justify-content-end">
                                <h2 class="me-5 m-0">Total:</h2>
                                <h1 class="ms-5 m-0 text-primary" id="total-price">${{ total|intcomma }}</h1>
                            </div>
                            <p class="note note-success mt-4" style="display: none;">
                                Se ha definido que el pago fue seleccionado como tipo
                                <b>{{ payment.get_tipo_display }}</b> el
                                <b>{{ payment.fecha_reg }} hrs</b>. {% if payment.validador %}Efectuado por
                                <b>{{ payment.validador }}</b>{% endif %}.
                            </p>
                            <div class="d-flex justify-content-end">
                                <button name="reverse-pay" class="btn btn-danger btn-sm btn-rounded shadow-0">
                                    <i class="fas fa-close me-2"></i>
                                    Revertir compra
                                </button>
                            </div>
                        </div>
                    </div>
    
                        {% if object.estatus == 'validatedx' %}
                            {% if not selected_places %}
                            <div class="alert" role="alert" data-mdb-color="warning">
                                <i class="fas fa-exclamation-triangle me-3"></i>Para continuar con el proceso de
                                la
                                Solicitud <a href="#places" class="btn btn-sm btn-warning shadow-0 ms-2">Asigna un
                                    espacio</a>
                            </div>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                {% endif %}
                {% if tpay_places and user.is_superuser %}
                    <div class="shadow-4 bg-white rounded-5 my-4 overflow-hidden p-4 d-flex justify-content-between align-items-center"
                        id="places">
                        <h4 class="mb-0 fw-bold">
                            <i class="fas fa-list-check me-3 green-text"></i>
                            Historial de lineas de captura TPAY
                        </h4>
                    </div>
                    <div class="shadow-4 bg-white rounded-5 p-4 mb-4">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th scope="col">Folio</th>
                                        <th scope="col">Número del lugar</th>
                                        <th scope="col">Sección</th>
                                        <th scope="col">Folio TPAY</th>
                                        <th scope="col">Precio</th>
                                        <th>Estatus</th>
                                        <th>Recibo</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for sp in tpay_places  %}
                                    <tr>
                                        <th scope="row">{{ sp.folio }}</th>
                                        <td>{{ sp.nombre }}</td>
                                        <td>{{ sp.get_zona_display }}</td>
                                        <td>{{ sp.tpay_folio }}</td>
                                        <td>${{ sp.precio|intcomma }}</td>
                                        <td>
                                            {% if sp.tpay_pagado %}
                                                <span class="badge rounded-pill badge-success">Pagado</span>
                                            {% else %}
                                                <button type="button" class="btn btn-rounded btn-warning status-place" data-uuid="{{ sp.uuid }}">
                                                    Validar
                                                </button>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if sp.tpay_pagado %}
                                                <button data-url="{{ sp.recibo_url }}" type="button"
                                                    class="btn btn-rounded btn-info pdf-place" data-uuid="{{ sp.uuid }}">
                                                    Recibo
                                                </button>
                                            {% endif %}
                                            
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                {% endif %}
                {% if pagado %}
                <div class="shadow-4 bg-white rounded-5 my-4 overflow-hidden p-4 d-flex justify-content-between align-items-center"
                    id="places">
                    <h4 class="mb-0 fw-bold">
                        <i class="fas fa-download me-3 green-text"></i>Descarga de documentos
                    </h4>
                </div>
                <div class="shadow-4 bg-white rounded-5 p-4 mb-4">
                    {% if payment.pagado %}
                    <div class="table-responsive">
                        <table class="table">
                            <tbody>
                                <tr>
                                    <th class="bg-light" style="width: 40%;">Contrato</th>
                                    <td><a class="btn btn-sm btn-success shadow-0"
                                            href="#">Descargar
                                            Contrato</a></td>
                                </tr>
                                {% for place in selected_places %}
                                <tr>
                                    <th class="bg-light" style="width: 40%;">
                                        {{ place.get_zona_display }}&nbsp;&nbsp;{{ place.nombre }}
                                        ({{ place.folio }})
                                    </th>
                                    <td><a class="btn btn-sm btn-success shadow-0"
                                            href="#">Descargar
                                            Gafete</a>
                                        <a class="btn btn-sm btn-primary shadow-0 ms-2"
                                            href="#">Descargar
                                            Suministros</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="note note-warning mt-4">
                        A la espera del comprobante de pago en efectivo para liberar los documentos de
                        descarga
                    </p>
                    <div class="d-flex justify-content-center">
                        <button name="cash-paid" style="display: none"
                            class="btn btn-primary btn-lg btn-rounded shadow-0 mt-5 ms-5 w-50">
                            <i class="fas fa-money-bill-1 me-2"></i>
                            Pagado con efectivo
                        </button>
                        <button name="transfer-paid"
                            class="btn btn-primary btn-lg btn-rounded shadow-0 mt-5 ms-5 w-50">
                            <i class="fas fa-right-left me-2"></i>
                            Aplicar Pagos
                        </button>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </form>
</div>
<!-- Modal Validations -->
<div class="modal fade" id="modal-validations" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Historial de Validaciones</h5>
                <button type="button" class="btn-close" data-mdb-ripple-init data-mdb-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <table class="table align-middle mb-0 bg-white">
                    <thead class="bg-light">
                        <tr>
                            <th>Estatus</th>
                            <th>Fecha</th>
                            <th>Comentarios</th>
                            <th>Campos seleccionados</th>
                            <th>Validador</th>
                            <th>Atendido</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for vl in object.validaciones.all %}
                        <tr>
                            <td>
                                {% if vl.estatus == 'validated' %}
                                <span class="badge rounded-pill badge-success">Validado</span>
                                {% elif vl.estatus == 'validated-direct' %}
                                <span class="badge rounded-pill badge-success">Validación directa</span>
                                {% elif vl.estatus == 'rejected' %}
                                <span class="badge rounded-pill badge-danger">Rechazado</span>
                                {% elif vl.estatus == 'pending' %}
                                <span class="badge rounded-pill badge-warning">Observado</span>
                                {% elif vl.estatus == 'resolved' %}
                                <span class="badge rounded-pill badge-primary">Solventado por el usuario</span>
                                {% else %}
                                <span class="badge rounded-pill badge-secondary">No asignado</span>
                                {% endif %}
                            </td>
                            <td>{{ vl.fecha_reg }}</td>
                            <td>{{ vl.comentarios|default:"No especificado" }}</td>
                            <td>
                                {% for key, value in vl.campos.field_comments.items %}
                                <b>{{ key|title }}</b>: {{ value }}
                                {% endfor %}
                            </td>
                            <td>
                                {% if not vl.estatus == 'resolved' %}
                                {{ vl.validador }}
                                {% endif %}
                            </td>
                            <td>
                                {% if vl.estatus == 'pending' %}
                                {{ vl.atendido|yesno:'Sí,No' }}
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="modal-footer d-flex justify-content-between">
                <a type="button" href="{% url 'admin:unlock_validation' object.uuid %}"
                    class="btn btn-warning shadow-0">Desbloquear solicitud</a>
                <button type="button" class="btn btn-secondary" data-mdb-ripple-init data-mdb-dismiss="modal">Cerrar
                </button>
            </div>
        </div>
    </div>
</div>
<!-- timer modal -->
<div class="modal fade" data-mdb-backdrop="static" data-mdb-keyboard="false" id="modal-timer" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h5 class="modal-title">Confirmar espacios seleccionados</h5>
            </div>
            <div class="modal-body">
                <input type="hidden" id="request-uuid" value="{{ object.uuid }}">
                <h1 id="timer" class="text-center">00:00:00</h1>
            </div>
            <div class="modal-footer">
                <button type="button" id="selection" class="btn btn-lg btn-rounded btn-primary shadow-0 w-100"><i
                        class="fas fa-check me-2"></i>Confirmar espacios
                </button>
                <button data-mdb-dismiss="modal" type="button" id="selection"
                    class="btn btn-lg btn-rounded btn-danger shadow-0 w-100"><i class="fas fa-ban me-2"></i>Cancelar
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock main %}